<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FREE YOUR MIND — Matrix Text RPG</title>
<style>
  :root{ --green:#32ff6a; --cyan:#39d2ff; --ink:#073b19; --light:#cffff3; }
  html,body{height:100%}
  body{margin:0;background:#000;color:#aef6cf;font-family:ui-monospace, monospace}
  #rain{position:fixed;inset:0;z-index:0;opacity:.42}
  #app{position:relative;z-index:1}
  .log{padding:6rem 1rem 7.5rem;height:100vh;overflow:auto;white-space:pre-line}
  .hud{position:fixed;top:.8rem;right:.8rem;font-size:12px;background:rgba(0,0,0,.55);border:1px solid var(--green);border-radius:8px;padding:10px 12px;color:#baffec;z-index:3;min-width:260px}
  .inputDock{position:fixed;left:50%;transform:translateX(-50%);bottom:1.1rem;width:min(980px,94vw);display:flex;gap:.5rem;z-index:3}
  .text{flex:1;background:rgba(0,0,0,.6);border:1px solid var(--green);color:#daf;padding:.85rem;font:16px/1.2 monospace;border-radius:.5rem}
  .btn{background:var(--ink);border:1px solid var(--green);color:#e8ffee;padding:.6rem .95rem;border-radius:.5rem;cursor:pointer}
  /* home */
  .home{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;z-index:4;background:rgba(0,0,0,.65);pointer-events:auto}
  .title{font-size:46px;letter-spacing:.08em;margin:0 0 .25rem 0;color:#baffec}
  .subtitle{opacity:.85;margin:.25rem 0 .9rem}
  .pillRow{display:flex;gap:1rem;margin-top:1rem;justify-content:center}
  .pill{width:140px;height:44px;border-radius:28px;border:2px solid var(--green);box-shadow:0 0 12px rgba(0,255,120,.25);transition:transform .08s, box-shadow .08s;cursor:pointer;pointer-events:auto}
  .pill:hover{transform:translateY(-2px);box-shadow:0 0 20px rgba(0,255,150,.35)}
  .red{background:#c31010}
  .blue{background:#0b57d0}
  .quote{margin-top:1rem;color:#9ff;max-width:680px}
  .instructions{margin-top:12px;text-align:left;max-width:740px;color:#baffec;font-size:14px}
  .instructions ol{padding-left:1.2rem}
</style>
</head>
<body>
<canvas id="rain"></canvas>
<div id="app">
  <!-- HUD -->
  <div id="hud" class="hud" hidden>
    <div><strong id="hudName">Neo</strong> — <span id="hudLvl">L1</span></div>
    <div>HP: <span id="hpText">120/120</span></div>
    <div>MP: <span id="mpText">50/50</span></div>
    <div>Weapon: <span id="hudWpn">Matrix Blade</span></div>
    <div>Credits: <span id="hudCred">80</span></div>
  </div>
  <!-- Log -->
  <div id="log" class="log"></div>
  <!-- Input -->
  <div class="inputDock" id="inputDock" hidden>
    <input id="cmd" class="text" placeholder="Type an action…"/>
    <button class="btn" id="go">Enter</button>
  </div>
  <!-- Home -->
  <div id="home" class="home" aria-modal="true">
    <div class="title">FREE YOUR MIND</div>
    <div class="subtitle">How far down the rabbit hole do you want to go?</div>
    <div class="pillRow" role="group" aria-label="Choose your path">
      <button id="red" type="button" class="pill red" aria-label="Take the red pill (start)">Red Pill</button>
      <button id="blue" type="button" class="pill blue" aria-label="Take the blue pill (exit)">Blue Pill</button>
    </div>
    <div class="quote">Morpheus: “You take the blue pill — the story ends… You take the red pill — you stay in Wonderland, and I show you how deep the rabbit hole goes.”</div>
    <div id="instructions" class="instructions">
      <strong>How to play</strong>
      <ol>
        <li>Click <em>Red Pill</em> to begin. The overlay disappears.</li>
        <li>Type natural actions in the bar at the bottom (e.g., <code>answer phone</code>, <code>hide</code>, <code>run</code>, <code>market</code>).</li>
        <li>In battle, try: <code>attack</code>, <code>hack</code>, <code>defend</code>, <code>focus</code>, <code>scan</code>, <code>overclock</code>, <code>item Health Pack</code>, <code>switch Pistol</code>.</li>
        <li>Boss wins open a save portal — type <code>save</code> to bind your progress.</li>
      </ol>
    </div>
  </div>
</div>
<script>
(function(){
  const c=document.getElementById('rain'); const ctx=c.getContext('2d');
  const resize=()=>{c.width=innerWidth; c.height=innerHeight;}; resize(); addEventListener('resize',resize);
  const fs=14; let cols=Math.floor(innerWidth/fs); let drops=new Array(cols).fill(1);
  const glyphs=[...'アカサタナハマヤラワ0123456789'];
  function draw(){ ctx.fillStyle='rgba(7,10,7,0.08)'; ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle='#32ff6a'; ctx.font=fs+'px monospace';
    for(let i=0;i<drops.length;i++){
      const ch=glyphs[(Math.random()*glyphs.length)|0];
      ctx.fillText(ch,i*fs,drops[i]*fs);
      if(drops[i]*fs>c.height && Math.random()>0.975) drops[i]=0;
      drops[i]+=1.12;
    }
    requestAnimationFrame(draw);
  } requestAnimationFrame(draw);
})();

const ui={
  home:document.getElementById('home'), red:document.getElementById('red'), blue:document.getElementById('blue'),
  log:document.getElementById('log'), hud:document.getElementById('hud'), inputDock:document.getElementById('inputDock'), cmd:document.getElementById('cmd'), go:document.getElementById('go')
};

let state={phase:'home', log:["Wake up, Neo…"], player:{name:'Neo',level:1,hp:120,mp:50,weapon:'Matrix Blade',credits:80}};

function render(){
  try{ ui.log.textContent = Array.isArray(state.log)? state.log.join('\\n') : String(state.log||''); }
  catch{ ui.log.textContent = '…'; }
  const ingame=(state.phase==='game');
  ui.hud.hidden=!ingame; ui.inputDock.hidden=!ingame;
}

function startGame(){
  state.phase='game'; state.log=["Wake up, Neo…"]; ui.home.hidden=true; render(); setTimeout(()=>ui.cmd.focus(),0);
}

function submit(cmd){ if(state.phase!=='game') return; if(!cmd) return; state.log.push('> '+cmd); 
  if(/^answer phone$/i.test(cmd)) {
    state.log.push("A whisper through static: 'They're coming.' The cubicle walls hum with code.");
  } else if (/^hide$/i.test(cmd)) {
    state.log.push("You press flat behind the partition. Footsteps pass. Time stretches.");
  } else if (/^run$/i.test(cmd)) {
    state.log.push("You bolt. The corridor spills green glyphs as alarms blossom behind you.");
  } else if (/^market$/i.test(cmd)) {
    state.log.push("A black market flickers in an alley subroutine. (Soon: trade commands.)");
  } else {
    state.log.push("The Matrix responds…");
  }
  render(); 
}

// Listeners
ui.red.addEventListener('click', startGame);
ui.red.addEventListener('keyup', (e)=>{ if(e.key==='Enter' || e.key===' ') startGame(); });
ui.blue.addEventListener('click', ()=>window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ','_blank'));
document.addEventListener('click',(e)=>{ if(e.target && e.target.closest && e.target.closest('#red')) startGame(); });

ui.go.addEventListener('click',()=>{const v=ui.cmd.value.trim(); ui.cmd.value=''; submit(v);});
ui.cmd.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ const v=ui.cmd.value.trim(); ui.cmd.value=''; submit(v);} });

render();
</script>
</body>
</html>
